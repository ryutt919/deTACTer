# 프로젝트 기획서: deTACTer (Tactical Analysis & Detection)

## 1. 프로젝트 개요
특정 팀의 세부 공격 전술 및 빌드업 패턴을 자동으로 탐지하고 가시화하여, 데이터 기반의 전술 분석 리포트를 제공합니다.

## 2. 주요 문제 정의
- **공격 세부 전술**: 팀의 VAEP(Valuing Actions by Estimating Probabilities) 수치가 특정 임계값(TH) 이상으로 상승하는 시퀀스 (수비 행동 제외).
    - TH : 시퀀스 전체의 누적 VAEP(Sum of VAEP)를 산출하여, 해당 팀 평균 대비 10~20% 이상의 시퀀스 식별.
- **시퀀스 정의**:
    - **유효 공격 시퀀스 (Effective Attack Sequence)**: **슈팅(Shot)**으로 마무리되거나, 최소한 **상대 패널티 박스(Penalty Box) 안으로 공을 투입**하는 데 성공한 시퀀스를 '유효 공격'으로 우선 규정함.
    - **공격 전술의 단위**: 위 유효 공격의 최종 단계 직전에 발생한 **유효한 이벤트들의 집합** (예: 박스 진입을 만든 결정적 패스, 공간 침투 드리블 등)을 해당 팀의 '핵심 공격 전술'로 정의함.
    - **시점 (Start)**: 소유권 획득 시점 (`Interception`, `Recovery` 등)을 기점으로 하되, 최종 성과(슈팅/박스 진입)로부터 **역추적(Backtracking)**하여 전술적 기점을 식별함.
    - **빌드업 (Build-up)**: 유효 공격 전술로 식별된 이벤트 집합 이전의 후방 연결 과정.
    #fixed 여전히 문제점이 있음. 지공상황은 보통 상대방 진영에서 지속적으로 소유권을 유지하는 것임 -> '성과 기반 역추적' 및 '하위 시퀀스 분할 로직' 적용으로 해결.
    - **지공 상황 하위 시퀀스 분할 전략 (Established Attack Segmentation)**:
        - **VAEP 스파이크 기반**: 소유권 유지 중 `vaep_value`가 누적 평균 대비 급격히 상승(예: >0.01)하는 지점을 '전술적 시도(Attempt)'의 기점으로 보아 시퀀스를 분할함.
        - **반대 전환(Switch of Play) 기반**: 좁은 구역에서 소유권을 유지하다 Y 좌표가 경기장 가로 폭의 50% 이상을 가로질러 이동하는 경우, 이전의 '유인 단계'와 이후의 '공간 공략 단계'로 분할.
        - **시간 밀도 기반**: 3초 이내에 3회 이상의 성공적인 액션(원터치 패스 등)이 집중될 때, 이를 하나의 '전술적 장면'으로 묶어 분석함.
    - **종료 (End)**: 슈팅, 소유권 전환, 혹은 경기 중단 (`Out`, `Pause` 등).


## 3. 핵심 기능

### Phase 1: 핵심 엔진 및 시각화
1. **전술 탐지 엔진**: 유사한 위치와 이벤트 시계열을 가진 시퀀스를 클러스터링.
2. **애니메이션 뷰어**: 탐지된 공격 및 빌드업 전술을 시각적인 애니메이션으로 제공.
3. **전술 선택 리스트**: "공격 전술 1, 2...", "빌드업 전술 1, 2..." 형태로 카테고리화하여 선택적 분석 지원.
4. #fixed 후순위, 최근 득점 시퀀스 보여주기 -> Phase 2 및 리포트 기능에 반영.

### Phase 2: 분석 고도화 (후순위)
1. **전술 자동 네이밍 (Auto-Naming)**: 클러스터링된 피처 특성을 추출하여 직관적인 명칭 부여 (예: "측면 빌드업 기반 크로스").
2. **성과 기반 스토리텔링**: 빌드업 단계의 누적 VAEP를 제시하여 득점 과정의 전술적 가치를 재조명.
3. **최근 득점 시퀀스 리포트**: 가장 최근 경기들의 득점 장면 시퀀스 집중 분석.

## 4. 데이터 전처리 및 피처 엔지니어링

### 4.1. 데이터 정규화 (Normalization)
- **공격 방향 통일**: 모든 데이터를 왼쪽에서 오른쪽으로 공격하는 방향으로 보정 (이미 적용됨).
- **좌표 스케일링 (0~1)**: 
    - **알고리즘적 이득**: X(105)와 Y(68)의 스케일 차이로 인해 X축 거리가 거리에 더 큰 가중치를 갖는 '편향(Bias)'을 방지합니다. DTW 및 클러스터링 시 모든 축이 동일한 중요도로 계산됩니다.
    - **확장성**: 경기장마다 미세하게 다른 규격을 통일된 스케일로 다룰 수 있어 모델의 범용성을 확보합니다.
    - **복원**: 분석 로직 내에서는 0~1을 사용하고, 애니메이션 시각화 시에만 기존 스케일로 복원합니다.
    #fixed 지금 공격방향은 통일돼있고 필드 사이즈에 맞게 데이터가 입력돼있는데, 이 x,y 좌표를 0~1로 정규화하는것이 이득일까? -> 알고리즘 성능 향상을 위해 0-1 정규화 확정.

### 4.2. 피처 추출
- **템포 (Tempo)**: 액션 간 거리($dx, dy$)와 소요 시간($dt$)을 기반으로 공격의 속도감 측정.
- **패턴 정렬 (DTW)**: 동적 시간 워핑(Dynamic Time Warping)을 활용하여 액션의 순서와 위치를 동시에 고려한 경로 유사도 측정.
- **Y축 반전 처리 (Mirroring)**: 
    #fixed 왼쪽과 오른쪽 측면 공격의 패턴의 빈도나 선수배치가 다르니까 반전 처리를 안하는게 좋을 수도 있음 -> '전술적 비대칭성' 분석을 위해 옵션으로 남겨둠.

## 5. 로직 흐름
1. **분석 대상 설정**: 특정 팀 및 분석 기간 선택.
2. **시퀀스 추출 및 필터링**: VAEP 임계값 기반 유의미한 시퀀스 선별.
3. **유사도 분석 및 클러스터링**: DTW 거리를 기반으로 유사 전술 패턴 그룹화.
4. **전술 시각화**: 클러스터별 대표 시퀀스 및 통계 제공.